---
releaseName: jupyterhub
name: jupyterhub
repo:
  name: jupyterhub
  url: https://jupyterhub.github.io/helm-chart/
version: 4.0.0
options:
  hub:
    config:
      Authenticator:
        admin_users:
          - justin.martin
        allowed_users:
          - justin.martin
      GenericOAuthenticator:
        client_id: jupyterhub
        client_secret: jupyterhubjupyterhub
        oauth_callback_url: http://172.19.0.3:32475/hub/oauth_callback
        authorize_url: https://172.19.0.3:31084/realms/demo/protocol/openid-connect/auth
        token_url: https://172.19.0.3:31084/realms/demo/protocol/openid-connect/token
        userdata_url: https://172.19.0.3:31084/realms/demo/protocol/openid-connect/userinfo
        username_claim: preferred_username
        tls_ca_path: /etc/ssl/certs/ca-certificates.crt
        scope:
          - openid
        enable_pkce: False
      JupyterHub:
        authenticator_class: generic-oauth
    extraEnv:
      # Not sure if all of these are necessary
      CURL_SSL_BACKEND: openssl # https://stackoverflow.com/a/76605700
      PYCURL_SSL_LIBRARY: openssl
      CURLOPT_SSL_VERIFYPEER: "false"
      CURLOPT_SSL_VERIFYHOST: "false"
      OAUTH2_TLS_VERIFY: "false"
      CACERT: /etc/ssl/certs/ca-certificates.crt
      CERT: /etc/ssl/certs/ca-certificates.crt
      CURLOPT_CAINFO: /etc/ssl/certs/ca-certificates.crt
    extraVolumes:
      - name: tls-ca-cert
        ephemeral:
          volumeClaimTemplate:
            metadata:
              annotations:
                secrets.stackable.tech/class: tls
            spec:
              storageClassName: secrets.stackable.tech
              accessModes:
                - ReadWriteOnce
              resources:
                requests:
                  storage: "1"
    extraVolumeMounts:
      - name: tls-ca-cert
        mountPath: /tls
      - name: tls-ca-cert
        mountPath: /etc/ssl/certs/keycloak-ca.crt
        subPath: ca.crt
      - name: tls-ca-cert
        mountPath: /etc/ssl/certs/ca-certificates.crt
        subPath: ca.crt
      - name: tls-ca-cert
        mountPath: /usr/local/lib/python3.12/site-packages/certifi/cacert.pem
        subPath: ca.crt
    service:
      type: NodePort
  proxy:
    service:
      type: NodePort
  rbac:
    create: true
  prePuller:
    hook:
      enabled: false
    continuous:
      enabled: false
  scheduling:
    userScheduler:
      enabled: false
  singleuser:
    cmd: null
    networkPolicy:
      enabled: false
    extraLabels:
      stackable.tech/vendor: Stackable
    storage:
      extraVolumes:
        - name: tls-ca-cert
          ephemeral:
            volumeClaimTemplate:
              metadata:
                annotations:
                  secrets.stackable.tech/class: tls
              spec:
                storageClassName: secrets.stackable.tech
                accessModes:
                  - ReadWriteOnce
                resources:
                  requests:
                    storage: "1"
      extraVolumeMounts:
        - name: tls-ca-cert
          mountPath: /stackable/secrets/tls-ca-cert
    profileList:
      - display_name: "Default"
        description: "Default profile"
        default: true
        profile_options:
          cpu:
            display_name: CPU
            choices:
              "2":
                display_name: "{{cpu}}"
                kubespawner_override:
                  cpu_guarantee: 2
                  cpu_limit: 2
              "1 request, 16 limit":
                display_name: "1 request, 16 limit"
                kubespawner_override:
                  cpu_guarantee: 1
                  cpu_limit: 16
              "5 request, 16 limit":
                display_name: "5 request, 16 limit"
                kubespawner_override:
                  cpu_guarantee: 5
                  cpu_limit: 16
          memory:
            display_name: Memory
            choices:
              "8 GB":
                display_name: "8 GB"
                kubespawner_override:
                  mem_guarantee: "8G"
                  mem_limit: "8G"
          image:
            display_name: Image
            choices:
              "jupyter/pyspark-notebook:python-3.9":
                display_name: "jupyter/pyspark-notebook:python-3.9"
                kubespawner_override:
                  image: "jupyter/pyspark-notebook:python-3.9"
