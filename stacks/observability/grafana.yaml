# yamllint disable rule:comments-indentation
---
# https://github.com/grafana/helm-charts/tree/main/charts/grafana
releaseName: grafana
name: grafana
repo:
  name: grafana
  url: https://grafana.github.io/helm-charts
# To find the latest version:
# helm repo add grafana https://grafana.github.io/helm-charts --force-update
# helm search repo grafana/grafana
version: 10.1.4 # 12.2.1
options:
  admin:
    existingSecret: grafana-admin-credentials
  service:
    type: NodePort
    port: 443
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Loki
          type: loki
          url: http://loki:3100
          access: proxy
          isDefault: false
          jsonData:
            tlsAuthWithCACert: false
        - name: Tempo
          type: tempo
          url: http://tempo:3100
          access: proxy
          isDefault: false
          jsonData:
            tlsAuthWithCACert: false
  readinessProbe:
    httpGet:
      scheme: HTTPS
  livenessProbe:
    httpGet:
      scheme: HTTPS
  testFramework:
    enabled: false
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 100m
      memory: 128Mi
  persistence:
    enabled: true
    # storageClassName: default
    accessModes:
      - ReadWriteOnce
    size: 1Gi
    # annotations: {}
    finalizers: []
  env:
    # Enable HTTPS, using a Certificate from the Secret Operator
    GF_SERVER_PROTOCOL: https
    GF_SERVER_CERT_FILE: /etc/grafana/certs/tls.crt
    GF_SERVER_CERT_KEY: /etc/grafana/certs/tls.key
  extraVolumeMounts:
    # Mount the certificate generated by the secret-operator
    - name: tls
      mountPath: /etc/grafana/certs/
  extraVolumes:
    # Request a TLS certificate from the secret-operator
    - name: tls
      ephemeral:
        volumeClaimTemplate:
          metadata:
            annotations:
              secrets.stackable.tech/class: tls
              secrets.stackable.tech/scope: node,pod,service=grafana
          spec:
            storageClassName: secrets.stackable.tech
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: "1"
