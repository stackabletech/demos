---
name: Pre-Release Demo Upgrade Testing
about: |
  This template can be used to track the upgrade testing of demos from stable to
  nightly leading up to the next Stackable release.
title: "chore(tracking): Test demo upgrades on nightly versions for YY.M.X"
labels: ['epic']
assignees: ''
---

<!--
    Make sure to update the link in 'stackabletech/issues/.github/ISSUE_TEMPLATE/release.md' when
    you change the filename.
-->

Part of <https://github.com/stackabletech/issues/issues/TRACKING_ISSUE>

This is testing that upgrades from the _stable_ release to the _nightly_ release of the operators
and products do not negatively impact the products.

> [!NOTE]
> Record the results (issues, anomalies, or success) during the process in a comment on this issue.
> Eg:
>
> ```md
> :green_circle: **airflow-scheduled-job**
>
> The CRD had been updated and I needed to change the following in the manifest:
> ...
> ```
>
> The following emojis can be used to indicate the status:
>
> - `hourglass`: In progress / waiting
> - `red_circle`: In progress with errors
> - `orange_circle`: Completed with minor issues or anomalies
> - `green_circle`: Completed without issues or errors

## List of demos

Replace the items in the lists below with the applicable Pull Requests (if any). Also put your
GitHub handle next to the demo to indicate a particular demo was picked up for testing.

<!--
    The following list was generated by:

    # go to the demos repository, then run:
    yq '.demos | keys' demos/demos-v2.yaml \
    | sed -e 's/- //g' \
    | sort \
    | xargs -I {} echo "- [ ] [{}](https://docs.stackable.tech/home/stable/demos/{})"
-->

<!-- TODO (@Techassi): Test stacks which don't have a demo -->

- [ ] [airflow-scheduled-job](https://docs.stackable.tech/home/stable/demos/airflow-scheduled-job)
- [ ] [argo-cd-git-ops](https://docs.stackable.tech/home/stable/demos/argo-cd-git-ops)
- [ ] [data-lakehouse-iceberg-trino-spark](https://docs.stackable.tech/home/stable/demos/data-lakehouse-iceberg-trino-spark)
- [ ] [end-to-end-security](https://docs.stackable.tech/home/stable/demos/end-to-end-security)
- [ ] [hbase-hdfs-load-cycling-data](https://docs.stackable.tech/home/stable/demos/hbase-hdfs-load-cycling-data)
- [ ] [jupyterhub-keycloak](https://docs.stackable.tech/home/stable/demos/jupyterhub-keycloak)
- [ ] [jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data](https://docs.stackable.tech/home/stable/demos/jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data)
- [ ] [logging](https://docs.stackable.tech/home/stable/demos/logging)
- [ ] [nifi-kafka-druid-earthquake-data](https://docs.stackable.tech/home/stable/demos/nifi-kafka-druid-earthquake-data)
- [ ] [nifi-kafka-druid-water-level-data](https://docs.stackable.tech/home/stable/demos/nifi-kafka-druid-water-level-data)
- [ ] [signal-processing](https://docs.stackable.tech/home/stable/demos/signal-processing)
- [ ] [spark-k8s-anomaly-detection-taxi-data](https://docs.stackable.tech/home/stable/demos/spark-k8s-anomaly-detection-taxi-data)
- [ ] [trino-iceberg](https://docs.stackable.tech/home/stable/demos/trino-iceberg)
- [ ] [trino-taxi-data](https://docs.stackable.tech/home/stable/demos/trino-taxi-data)

## Stable to Nightly Upgrade Testing Instructions

These instructions are for deploying and completing the stable demo, and then
upgrading operators, CRDs, and products to the nightly versions well as upgrading
the operators and CRDS.

<!--
    Make sure to update the version mentioned below when creating the issue.
-->

> [!TIP]
> Be sure to select the _stable_ docs version on <https://docs.stackable.tech/home/stable/demos/>.

```shell
# Install demo (stable operators) for the stable release (OO.M).
stackablectl demo install <DEMO_NAME>

# --- IMPORTANT ---
# Run through the stable demo instructions (refer to the list above).

# Get a list of installed operators
stackablectl operator installed --output=plain

# Uninstall operators for the stable release (OO.M)
stackablectl release uninstall OO.M

# Update CRDs to nightly version (on main)
# Repeat this for every operator used by the demo (use the list from the earlier step before deleting the operators)
kubectl replace -f https://raw.githubusercontent.com/stackabletech/commons-operator/main/deploy/helm/commons-operator/crds/crds.yaml
kubectl replace -f https://raw.githubusercontent.com/stackabletech/...-operator/main/deploy/helm/...-operator/crds/crds.yaml

# Install nightly version of operators (use the list from the earlier step before deleting the operators)
stackablectl operator install commons ...

# Optionally update the product versions in the CRDs (to the latest non-experimental version for the new release), e.g.:
kubectl patch hbaseclusters/hbase --type='json' -p='[{"op": "replace", "path": "/spec/image/productVersion", "value":"x.x.x"}]' # changed
```
